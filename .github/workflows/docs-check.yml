name: Docs and Links (soft gate)

on:
  pull_request:
    types: [opened, synchronize, reopened, ready_for_review]
  workflow_dispatch:

jobs:
  check-readmes:
    runs-on: ubuntu-latest
    continue-on-error: true
    steps:
      - uses: actions/checkout@v4

      - name: Ensure top-level README exists
        run: |
          test -s README.md || (echo "README.md missing or empty" && exit 1)

      - name: Ensure item READMEs exist
        run: |
          missing=0
          # Standalone items (if present)
          for base in templates libraries; do
            [ -d "$base" ] || continue
            while IFS= read -r dir; do
              [ -s "$dir/README.md" ] || { echo "$dir missing README.md"; missing=1; }
            done < <(find "$base" -mindepth 2 -maxdepth 2 -type d)
          done

          # Packs: only check pack root README
          if [ -d packs ]; then
            while IFS= read -r packdir; do
              [ -s "$packdir/README.md" ] || { echo "$packdir missing README.md"; missing=1; }
            done < <(find packs -mindepth 1 -maxdepth 1 -type d)
          fi
          exit $missing
